var ChatbotWidget=function(S,l,y,Q,v,W){"use strict";function H(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var T={exports:{}},g={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B;function Y(){if(B)return g;B=1;var t=l,s=Symbol.for("react.element"),c=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function b(d,i,p){var u,f={},x=null,E=null;p!==void 0&&(x=""+p),i.key!==void 0&&(x=""+i.key),i.ref!==void 0&&(E=i.ref);for(u in i)n.call(i,u)&&!a.hasOwnProperty(u)&&(f[u]=i[u]);if(d&&d.defaultProps)for(u in i=d.defaultProps,i)f[u]===void 0&&(f[u]=i[u]);return{$$typeof:s,type:d,key:x,ref:E,props:f,_owner:r.current}}return g.Fragment=c,g.jsx=b,g.jsxs=b,g}var M;function Z(){return M||(M=1,T.exports=Y()),T.exports}var e=Z(),R={exports:{}},O,P;function J(){if(P)return O;P=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return O=t,O}var I,k;function _(){if(k)return I;k=1;var t=J();function s(){}function c(){}return c.resetWarningCache=s,I=function(){function n(b,d,i,p,u,f){if(f!==t){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}n.isRequired=n;function r(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:r,element:n,elementType:n,instanceOf:r,node:n,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:c,resetWarningCache:s};return a.PropTypes=a,a},I}var q;function L(){return q||(q=1,R.exports=_()()),R.exports}var z=L();const w=H(z),D=l.createContext(null),$=({children:t})=>{const s=l.useRef(new y.RTVIClient({transport:new Q.DailyTransport,params:{baseUrl:"http://0.0.0.0:7860",endpoints:{connect:"/connect"}},enableMic:!0}));return e.jsx(D.Provider,{value:s.current,children:t})},ee=()=>{const t=l.useContext(D);if(!t)throw new Error("usePipeCat must be used within a PipeCatProvider");return t},j=(t,s="white")=>{const c=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${s}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${t}</svg>`;return`data:image/svg+xml;base64,${btoa(c)}`},te=()=>e.jsx("img",{src:j('<path d="m22 2-7 20-4-9-9-4Z" /><path d="M22 2 11 13" />'),alt:"Send",className:"cb-w-5 cb-h-5 cb-text-current"}),ce=()=>e.jsx("img",{src:j('<path d="M18 6 6 18" /><path d="m6 6 12 12" />'),alt:"Close",className:"cb-w-6 cb-h-6 cb-text-current"}),ne=()=>e.jsx("img",{src:j('<path d="M18.36 6.64A9 9 0 0 1 20.77 15" /><path d="M6.16 6.16a9 9 0 1 0 12.68 12.68" /><path d="M12 2v4" />'),alt:"Power",className:"cb-w-6 cb-h-6 cb-text-current"}),A=({onWhiteBackground:t=!1})=>e.jsx("img",{src:j('<path d="M12 8V4H8" /><rect width="16" height="12" x="4" y="8" rx="2" /><path d="M2 14h2" /><path d="M20 14h2" /><path d="M15 13v2" /><path d="M9 13v2" />',t?"#6B46C1":"white"),alt:"Bot",className:"cb-w-6 cb-h-6"}),se=(t,s=30)=>{const[c,n]=l.useState(""),r=l.useRef(null);return l.useEffect(()=>{let a=0;const b=setInterval(()=>{a<t.length?(n(t.substring(0,a+1)),a++,r.current&&r.current.scrollIntoView({behavior:"smooth",block:"end"})):clearInterval(b)},s);return()=>clearInterval(b)},[t,s]),{displayedText:c,containerRef:r}},re=t=>{const s=[];let c=0;for(;c<t.length;){const n=Math.min(t.indexOf("[",c)===-1?1/0:t.indexOf("[",c),t.indexOf("- {",c)===-1?1/0:t.indexOf("- {",c));if(n===1/0)break;if(n>c&&s.push({type:"text",content:t.slice(c,n).trim()}),t[n]==="["){const r=t.indexOf("]",n)+1;if(r===0)break;try{const a=t.slice(n,r),b=JSON.parse(a.replace(/'/g,'"'));s.push({type:"table",data:b}),c=r}catch{c=n+1}}else{let r=[],a=n;for(;a!==-1&&t.startsWith("- {",a);){const b=t.indexOf("}",a)+1;if(b===0)break;try{const d=t.slice(a+2,b),i=JSON.parse(d.replace(/'/g,'"'));r.push(i),a=t.indexOf("- {",b)}catch{break}}r.length>0?(s.push({type:"table",data:r}),c=t.indexOf("}",n)+1):c=n+1}}return c<t.length&&s.push({type:"text",content:t.slice(c).trim()}),s},ae=({data:t})=>{const s=Object.keys(t[0]);return e.jsx("div",{className:"cb-w-fit",children:e.jsxs("table",{className:"cb-w-full cb-border-collapse cb-text-sm cb-table",children:[e.jsx("thead",{children:e.jsx("tr",{className:"cb-bg-purple-100",children:s.map(c=>e.jsx("th",{className:"cb-border cb-border-purple-200 cb-p-2 cb-text-left cb-font-semibold cb-text-gray-800 cb-table-cell",children:c.charAt(0).toUpperCase()+c.slice(1)},c))})}),e.jsx("tbody",{children:t.map((c,n)=>e.jsx("tr",{className:"cb-even:bg-purple-50",children:s.map(r=>e.jsx("td",{className:"cb-border cb-border-purple-200 cb-p-2 cb-text-sm cb-text-gray-800 cb-table-cell",children:c[r]},r))},n))})]})})},U=({message:t,type:s})=>{const c=s==="user",n=t.includes("[")||t.includes("- {"),{displayedText:r,containerRef:a}=se(s==="assistant"&&!n?t:""),b=()=>{if(!c&&n)try{const d=re(t);return e.jsx("div",{className:`cb-w-fit ${c?"cb-text-white":"cb-text-gray-800"}`,children:d.map((i,p)=>e.jsxs(l.Fragment,{children:[i.type==="text"&&e.jsx("p",{className:`cb-my-2 cb-font-semibold ${c?"cb-text-white":"cb-text-gray-800"}`,children:i.content}),i.type==="table"&&e.jsx("div",{className:"cb-my-4",children:e.jsx(ae,{data:i.data})})]},p))})}catch(d){return console.error("Error parsing sections:",d),e.jsx("span",{children:t})}return e.jsx("span",{className:c?"cb-text-white":"cb-text-gray-800",children:s==="assistant"?r:t})};return e.jsxs("div",{ref:a,className:`cb-flex ${c?"cb-flex-row-reverse cb-text-white":"cb-flex-row cb-text-gray-800"} cb-items-end cb-gap-2 cb-mb-4`,children:[s==="assistant"&&e.jsx("div",{className:"cb-h-8 cb-w-8 cb-flex cb-items-center cb-justify-center cb-rounded-full cb-bg-[#BE3CEB] cb-flex-shrink-0",children:e.jsx(A,{className:"cb-w-5 cb-h-5 cb-text-white"})}),e.jsx("div",{className:`cb-w-fit cb-p-3 cb-rounded-lg ${c?"cb-bg-[#BE3CEB] cb-text-white cb-rounded-br-none cb-ml-auto":"cb-bg-gray-100 cb-text-gray-800 cb-rounded-bl-none cb-mr-auto"} cb-font-semibold cb-text-sm`,children:b()})]})};U.propTypes={message:w.string.isRequired,type:w.string.isRequired};const oe=()=>e.jsx("div",{className:"cb-flex cb-items-center cb-bg-gray-100 cb-py-3 cb-px-4 cb-rounded-lg cb-w-fit",children:e.jsxs("div",{className:"cb-flex cb-items-center cb-gap-2",children:[e.jsx("div",{className:"cb-w-2 cb-h-2 cb-rounded-full cb-bg-gray-500 cb-animate-bounce"}),e.jsx("div",{className:"cb-w-2 cb-h-2 cb-rounded-full cb-bg-gray-500 cb-animate-bounce [animation-delay:-0.15s]"}),e.jsx("div",{className:"cb-w-2 cb-h-2 cb-rounded-full cb-bg-gray-500 cb-animate-bounce [animation-delay:-0.3s]"})]})}),ie="data:image/png;base64,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",le=({apiKey:t})=>{const[s,c]=l.useState([]),[n,r]=l.useState(""),[a,b]=l.useState(!1),[d,i]=l.useState(!1),p=ee(),[u,f]=l.useState(!1);l.useState(!1);const[x,E]=l.useState(!1),C=useRef(null),m=useRef(null);useEffect(()=>(m.current=new ChatWebSocket(t,{onConnect:()=>f(!0),onDisconnect:()=>f(!1),onTyping:()=>b(!0),onMessage:o=>{b(!1),c(h=>[...h,{role:"assistant",content:o}])},onLocalMessage:o=>{c(h=>[...h,{role:"user",content:o}])},onReady:()=>{E(!0)},onSessionEnd:()=>{i(!0)}}),()=>{var o;return(o=m.current)==null?void 0:o.disconnect()}),[t]),useEffect(()=>{isOpen&&!u&&(m.current.manuallyEnded=!1,m.current.connect())},[isOpen,u]),useEffect(()=>{C.current&&(C.current.scrollTop=C.current.scrollHeight)},[s,a]),useEffect(()=>{onStateChange&&onStateChange(isOpen)},[isOpen,onStateChange]),v.useRTVIClientEvent(y.RTVIEvent.UserTranscript,o=>{o.final&&c(h=>[...h,{role:"user",content:o.text}])}),v.useRTVIClientEvent(y.RTVIEvent.BotTranscript,o=>{c(h=>[...h,{role:"assistant",content:o.text}]),b(!1)}),v.useRTVIClientEvent(y.RTVIEvent.BotTyping,()=>{b(!0)}),v.useRTVIClientEvent(y.RTVIEvent.SessionEnd,()=>{i(!0)});const X=o=>{if(o.preventDefault(),!(!n.trim()||!u||!x))try{m.current.sendMessage(n),r("")}catch(h){console.error("Failed to send message:",h)}},de=async o=>{if(o.preventDefault(),!!n.trim())try{await p.sendMessage(n),r("")}catch(h){console.error("Failed to send message:",h)}},he=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),X(o))},G=async()=>{await p.disconnect(),m.current.disconnect(!0),c([]),i(!0)},pe=async()=>{c([]),i(!1),await p.connect(),m.current.connect()};return e.jsxs("div",{className:`cb-chat-window cb-fixed cb-bottom-4 cb-right-[4.5rem] cb-origin-bottom-left cb-transition-all cb-duration-200 cb-w-[400px] cb-h-[600px] cb-bg-gray-50 cb-rounded-lg cb-shadow-xl cb-flex cb-flex-col ${isOpen?"cb-scale-100 cb-opacity-100 cb-translate-y-0":"cb-scale-95 cb-opacity-0 cb-translate-y-4"}`,children:[d&&e.jsx("div",{className:"cb-modal-backdrop",children:e.jsxs("div",{className:"cb-modal-content",children:[e.jsx("p",{className:"cb-session-ended-text",children:"The last session is over. Please start over if you require further help."}),e.jsxs("div",{className:"cb-session-ended-buttons",children:[e.jsx("button",{onClick:pe,className:"cb-session-button cb-start-again",children:"Start Again"}),e.jsx("button",{onClick:G,className:"cb-session-button cb-cancel",children:"Cancel"})]})]})}),e.jsxs("div",{className:"cb-bg-[#BE3CEB] cb-p-4 cb-rounded-t-lg cb-flex cb-items-center cb-justify-between cb-z-50",children:[e.jsxs("div",{className:"cb-flex cb-items-center cb-gap-2",children:[e.jsx("div",{className:"cb-h-7 cb-w-7 cb-flex cb-items-center cb-justify-center cb-rounded-full cb-bg-white",children:e.jsx(A,{className:"cb-w-5 cb-h-5 cb-text-[#BE3CEB] cb-cursor-pointer",onWhiteBackground:!0})}),e.jsxs("h2",{className:"cb-text-white cb-flex cb-items-center cb-justify-center cb-text-lg cb-font-semibold",children:["Quibble Support",u&&x&&e.jsx("span",{className:"cb-inline-block cb-w-2 cb-h-2 cb-rounded-full cb-bg-green-400 cb-ml-2"})]})]}),e.jsxs("div",{className:"cb-flex cb-items-center cb-gap-2",children:[e.jsx("button",{onClick:G,className:"cb-text-white hover:cb-text-red-200 cb-transition-colors cb-cursor-pointer",title:"End Chat",children:e.jsx(ne,{className:"cb-w-6 cb-h-6 cb-cursor-pointer"})}),e.jsx("button",{onClick:()=>setIsOpen(!1),className:"cb-text-white hover:cb-text-purple-200 cb-transition-colors cb-cursor-pointer",title:"Close Chat",children:e.jsx(ce,{className:"cb-w-6 cb-h-6 cb-cursor-pointer"})})]})]}),e.jsxs("div",{ref:C,className:"cb-flex-1 cb-overflow-y-auto cb-p-4 cb-space-y-4 cb-bg-gray-50 cb-chat-messages cb-z-50",children:[s.map((o,h)=>e.jsx(U,{message:o.content,type:o.role==="user"?"user":"assistant"},h)),a&&e.jsxs("div",{className:"cb-flex cb-items-center cb-gap-2",children:[e.jsx("div",{className:"cb-h-8 cb-w-8 cb-flex cb-items-center cb-justify-center cb-rounded-full cb-bg-[#BE3CEB]",children:e.jsx(A,{className:"cb-w-5 cb-h-5 cb-text-white"})}),e.jsx(oe,{})]})]}),e.jsx("div",{className:"cb-bg-white cb-p-4 cb-shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] cb-z-20",children:e.jsx("form",{onSubmit:X,className:"cb-relative",children:e.jsxs("div",{className:"cb-flex cb-gap-2",children:[e.jsx("button",{onClick:de,className:"cb-p-2 cb-text-white cb-bg-[#BE3CEB] cb-rounded-lg hover:cb-bg-[#ac2adb] disabled:cb-bg-gray-400 disabled:cb-cursor-not-allowed cb-transition-colors",children:e.jsx(MicIcon,{className:"cb-w-5 cb-h-5"})}),e.jsx("textarea",{value:n,onChange:o=>r(o.target.value),onKeyDown:he,placeholder:"Type a message...",className:"cb-flex-1 cb-resize-none cb-p-2 cb-border cb-rounded-lg cb-border-gray-300 focus:cb-outline-none focus:cb-border-[#BE3CEB] focus:cb-ring-1 focus:cb-ring-[#BE3CEB] cb-bg-white cb-max-h-32 cb-font-normal",rows:"1"}),e.jsx("button",{type:"submit",disabled:!u,className:"cb-p-2 cb-text-white cb-bg-[#BE3CEB] cb-rounded-lg hover:cb-bg-[#ac2adb] disabled:cb-bg-gray-400 disabled:cb-cursor-not-allowed cb-transition-colors",children:e.jsx(te,{className:"cb-w-5 cb-h-5"})})]})})})]})},V=({onStateChange:t,apiKey:s})=>{const[c,n]=l.useState(!1),r=()=>{const a=!c;n(a),t&&t(a)};return e.jsx("div",{className:"cb-fixed cb-inset-0 cb-pointer-events-none",children:e.jsxs("div",{className:"cb-fixed cb-bottom-4 cb-right-4 cb-pointer-events-auto",children:[e.jsx("button",{onClick:r,className:`cb-toggle-button ${c?"cb-hidden":""}`,children:e.jsx("img",{src:ie,alt:"quibbleAI",className:"cb-w-8 cb-h-8 cb-cursor-pointer"})}),c&&e.jsx($,{children:e.jsx(le,{apiKey:s})})]})})};V.propTypes={apiKey:w.string.isRequired,onStateChange:w.func};var N={},F;function be(){if(F)return N;F=1;var t=W;return N.createRoot=t.createRoot,N.hydrateRoot=t.hydrateRoot,N}var ue=be();function K(t,s={}){const c=document.createElement("div");c.id="chatbot-container",document.body.appendChild(c),ue.createRoot(c).render(l.createElement(l.StrictMode,null,l.createElement(V,{apiKey:t,onStateChange:s.onStateChange})))}return window.ChatbotWidget={init:K},S.init=K,Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}),S}({},React,PipeCatClient,DailyTransport,PipeCatReact,ReactDOM);
